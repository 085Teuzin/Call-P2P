<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call P2P - Made By: @085_Teuzinnn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            overflow: hidden;
        }
        .bg-custom { background-color: #f97316; }
        .text-custom { color: #f97316; }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2.5rem;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(249, 115, 22, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }
        #settingsModal { display: none; background: rgba(0, 0, 0, 0.8); }
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
    </style>
</head>
<body class="p-4">

    <div class="absolute top-5 right-5">
        <button onclick="toggleModal()" class="text-2xl hover:rotate-90 transition duration-300">⚙️</button>
    </div>

    <div class="w-full max-w-sm text-center">
        <h1 class="text-4xl font-bold mb-2">Call P2P</h1>
        <h2 class="text-gray-400 text-sm mb-8">Conexão direta por voz via ID</h2>

        <div class="glass-card p-8 shadow-2xl relative overflow-hidden">
            <div id="statusIndicator" class="w-28 h-28 bg-custom rounded-full mx-auto mb-6 flex items-center justify-center text-4xl shadow-lg transition-all duration-500">
                <i id="mainIcon" class="fas fa-microphone"></i>
            </div>

            <div id="setupArea">
                <div class="mb-6">
                    <p class="text-xs text-gray-500 uppercase tracking-widest mb-1">Seu ID</p>
                    <div class="flex items-center justify-center gap-2 bg-slate-800 p-3 rounded-2xl border border-slate-700">
                        <span id="my-id" class="font-mono font-bold text-orange-400 text-lg">Gerando...</span>
                        <button onclick="copyId()" class="text-gray-400 hover:text-white"><i class="far fa-copy"></i></button>
                    </div>
                </div>

                <input type="text" id="peer-id" placeholder="ID do parceiro" class="w-full bg-slate-900 border border-slate-700 rounded-2xl p-4 text-center mb-4 focus:outline-none focus:border-orange-500 transition">
                
                <button id="call-btn" onclick="makeCall()" class="w-full bg-custom hover:bg-orange-600 text-white font-bold py-4 rounded-2xl transition duration-300 flex items-center justify-center gap-2">
                    <i class="fas fa-phone"></i> Iniciar Chamada
                </button>
            </div>

            <div id="callControls" class="hidden flex flex-col items-center">
                <p id="call-timer" class="text-orange-400 font-mono mb-6 text-xl">00:00</p>
                
                <div class="flex justify-center gap-4 w-full">
                    <button id="mute-btn" onclick="toggleMute()" class="control-btn bg-slate-700 hover:bg-slate-600">
                        <i class="fas fa-microphone"></i>
                    </button>
                    
                    <button onclick="hangUp()" class="control-btn bg-red-500 hover:bg-red-600">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                    
                    <button id="speaker-btn" onclick="toggleSpeaker()" class="control-btn bg-slate-700 hover:bg-slate-600">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="fixed inset-0 z-50 flex items-center justify-center p-6">
        <div class="bg-slate-800 w-full max-w-xs rounded-3xl p-6 border border-slate-700 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-center">Configurações</h3>
            <div class="grid grid-cols-4 gap-3 mb-6">
                <button onclick="changeTheme('#f97316')" class="w-10 h-10 rounded-full bg-orange-500"></button>
                <button onclick="changeTheme('#3b82f6')" class="w-10 h-10 rounded-full bg-blue-500"></button>
                <button onclick="changeTheme('#10b981')" class="w-10 h-10 rounded-full bg-emerald-500"></button>
                <button onclick="changeTheme('#a855f7')" class="w-10 h-10 rounded-full bg-purple-500"></button>
            </div>
            <button onclick="toggleModal()" class="w-full bg-slate-700 py-3 rounded-xl transition">Voltar</button>
        </div>
    </div>

    <footer class="text-center mt-5 text-gray-500 text-sm">
        Made By: <a href="https://instagram.com/085_Teuzinnn" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold transition duration-200">@085_Teuzinnn</a>
    </footer>

    <audio id="remoteAudio"></audio>

    <script>
        const myIdDisplay = document.getElementById('my-id');
        const peerIdInput = document.getElementById('peer-id');
        const setupArea = document.getElementById('setupArea');
        const callControls = document.getElementById('callControls');
        const statusIndicator = document.getElementById('statusIndicator');
        const remoteAudio = document.getElementById('remoteAudio');
        const timerDisplay = document.getElementById('call-timer');
        
        let peer = new Peer();
        let localStream;
        let currentCall;
        let isMuted = false;
        let isSpeaker = false;
        let timerInterval;
        let seconds = 0;

        peer.on('open', id => myIdDisplay.innerText = id);

        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => { localStream = stream; })
            .catch(err => alert('Acesso ao microfone negado!'));

        peer.on('call', call => {
            if (confirm("Recebendo chamada P2P... Aceitar?")) {
                call.answer(localStream);
                handleCall(call);
            }
        });

        function makeCall() {
            const id = peerIdInput.value;
            if (!id) return alert('Insira um ID válido');
            const call = peer.call(id, localStream);
            handleCall(call);
        }

        function handleCall(call) {
            currentCall = call;
            call.on('stream', stream => {
                remoteAudio.srcObject = stream;
                remoteAudio.play();
                uiInCall();
                startTimer();
            });
            call.on('close', uiEndCall);
            call.on('error', uiEndCall);
        }

        function toggleMute() {
            isMuted = !isMuted;
            localStream.getAudioTracks()[0].enabled = !isMuted;
            const btn = document.getElementById('mute-btn');
            btn.innerHTML = isMuted ? '<i class="fas fa-microphone-slash"></i>' : '<i class="fas fa-microphone"></i>';
            btn.classList.toggle('bg-red-500', isMuted);
        }

        function toggleSpeaker() {
            isSpeaker = !isSpeaker;
            const btn = document.getElementById('speaker-btn');
            if (isSpeaker) {
                btn.innerHTML = '<i class="fas fa-volume-up"></i>';
                btn.classList.add('bg-orange-500');
                if (remoteAudio.setSinkId) remoteAudio.setSinkId(''); 
            } else {
                btn.innerHTML = '<i class="fas fa-volume-down"></i>';
                btn.classList.remove('bg-orange-500');
            }
        }

        function hangUp() {
            if (currentCall) currentCall.close();
            uiEndCall();
        }

        function uiInCall() {
            setupArea.classList.add('hidden');
            callControls.classList.remove('hidden');
            statusIndicator.classList.add('pulse-animation');
            document.getElementById('mainIcon').className = 'fas fa-phone';
        }

        function uiEndCall() {
            setupArea.classList.remove('hidden');
            callControls.classList.add('hidden');
            statusIndicator.classList.remove('pulse-animation');
            document.getElementById('mainIcon').className = 'fas fa-microphone';
            stopTimer();
            location.reload(); 
        }

        function startTimer() {
            seconds = 0;
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                timerDisplay.innerText = `${m}:${s}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function copyId() {
            navigator.clipboard.writeText(myIdDisplay.innerText);
            alert('ID Copiado!');
        }

        function toggleModal() {
            const m = document.getElementById('settingsModal');
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        }

        function changeTheme(color) {
            statusIndicator.style.backgroundColor = color;
            document.getElementById('call-btn').style.backgroundColor = color;
            timerDisplay.style.color = color;
        }
    </script>
</body>
</html>